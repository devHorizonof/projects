<!DOCTYPE html>
<html lang="en">
<head>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calculator</title>
    <link rel="stylesheet" href="./styles/index.css">

    <link rel="shortcut icon" href="../../assets/perfil-tik.png" type="image/x-icon">

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- Dropdown Works -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </head>
</head>
<body>
  <nav class="navbar navbar-expand-sm navbar-dark bg-dark ">
    <div class="container">
      <a class="navbar-brand" href="https://github.com/devHorizonof">
        <img src="../../assets/perfil-tik.png" alt="Avatar Logo" style="width:40px;" class="rounded-pill"> 
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mynavbar">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://www.instagram.com/devhorizonof/reels/" target="_blank">Instagram</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.youtube.com/channel/UC5iZVvInc8dVhdxcHrxejIA" target="_blank">Shorts</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.tiktok.com/@devhorizon" target="_blank">Tiktok</a>
          </li>
        </ul>
        <form class="d-flex">
          <button type="button" id="toggle-form"  class="btn btn-outline-secondary">Login</button>
        </form>
      </div>
    </div>
  </nav>
  <div class="bg-model"></div>

  <!-- Centralizar -->
  <!-- Centralize -->
  <div class="container d-flex justify-content-center p-4">
    <div class="calculator">
      <div class="display">
        <!-- Add Scroll in the near future -->
        <!-- Adicionar Scroll em um futuro próximo -->
        <input class="old-account" value="" disabled>
        <input class="new-account"  value="" disabled>
      </div>
      <div class="sup">
        <div class="line">
           <!-- Add  in the near future -->
          <!-- Adicionar  em um futuro próximo -->
          <button class="btn btn-light">e</button>
          <button class="btn btn-light">%</button>
          <button class="btn btn-light">sin</button>
          <button class="btn btn-light">deg</button>
        </div>
        <div class="line">
          <button onclick="clearDisplay()" class="btn btn-light">Ac</button>
          <button onclick="clearLast()" class="btn btn-light"><img src="./assets/Vector.svg" alt="" srcset=""></button>
          <button onclick="appendToDisplay('/')" class="btn btn-primary">/</button>
          <button onclick="appendToDisplay('*')" class="btn btn-primary">*</button>
        </div>
        <div class="line">
          <button onclick="appendToDisplay(7)" class="btn btn-light">7</button>
          <button onclick="appendToDisplay(8)" class="btn btn-light">8</button>
          <button onclick="appendToDisplay(9)" class="btn btn-light">9</button>
          <button onclick="appendToDisplay('-')" class="btn btn-primary">-</button>
        </div>
      </div>
      <div class="bot">
        <div class="left">
          <div class="line">
            <button onclick="appendToDisplay(4)" class="btn btn-light">4</button>
            <button onclick="appendToDisplay(5)" class="btn btn-light">5</button>
            <button onclick="appendToDisplay(6)" class="btn btn-light">6</button>
          </div>
          <div class="line">
            <button onclick="appendToDisplay(1)" class="btn btn-light">1</button>
            <button onclick="appendToDisplay(2)" class="btn btn-light">2</button>
            <button onclick="appendToDisplay(3)" class="btn btn-light">3</button>
          </div>
          <div class="line">
            <button onclick="appendToDisplay(0)" class="btn btn-light btn-zero">0</button>
            <button onclick="appendToDisplay('.')" class="btn btn-light">.</button>
          </div>
        </div>
        <div class="right">
          <div class="column">
            <button onclick="appendToDisplay('+')" class="btn btn-primary btn-h">+</button>
            <button onclick="calculate()" class="btn btn-primary btn-h">=</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let lastInputWasOperator = false
    let firstInputWasNumber = false
    let lastNumberContainsDecimal = false
    function appendToDisplay(value) {
       // Verifica se o último caractere foi um operador
       // Checks if the last character was an operator
      if (lastInputWasOperator && /[-+*/]/.test(value)) {
        // Caso seja, apaga o último operar e troca pelo novo
        // If so, delete the last operation and exchange it for the new one
        clearLast()
        document.querySelector('.new-account').value += value;

        lastInputWasOperator = /[-+*/]/.test(value);
        firstInputWasNumber = /[1234567890]/.test(value);
        
        return;
      }
      
      
      // Verifica se possui um número antes do operador
      // Check if you have a number before the operator
      if (!firstInputWasNumber && /[-+*/]/.test(value)) {
        return;
      }-1
      
      if (value === '.' && !lastNumberContainsDecimal && firstInputWasNumber) {
        lastNumberContainsDecimal = true
        document.querySelector('.new-account').value += value; 
      } else if ((value === '.' && lastNumberContainsDecimal && !lastInputWasOperator)) {
        return;
        
      } else if (value === '.' && lastInputWasOperator){
        return;

      } else if (/[1234567890]/.test(value)) {
        document.querySelector('.new-account').value += value;
        lastInputWasOperator = false
        
      } else if (/[-+*/]/.test(value) && !lastInputWasOperator) {
        document.querySelector('.new-account').value += value;
        lastNumberContainsDecimal = false
        lastInputWasOperator = true
        
      } 
      
      firstInputWasNumber = /[1234567890]/.test(value)
    
    }

    function clearDisplay() {
      document.querySelector('.new-account').value = '';
      document.querySelector('.old-account').value = '';
      lastInputWasOperator = false
      firstInputWasNumber = false
      lastNumberContainsDecimal = false

    }

    function clearLast() {
      const display =  document.querySelector('.new-account');
      const currentValue = display.value;
      display.value = currentValue.slice(0, -1); 

      let lastValue = document.querySelector('.new-account').value.slice(-1);

      if (/[-+*/]/.test(lastValue)){
        lastInputWasOperator = true
      } else {
        lastInputWasOperator = false
      }

      if (/[1234567890]/.test(lastValue)){
        firstInputWasNumber = true
      } else {
        firstInputWasNumber = false
      }
    }
    
    // Full code in github @devHorizonof
    // Código completo no github @devHorizonof
    function calculate() {
      let lastValue = document.querySelector('.new-account').value.slice(-1);
      
      if (/[-+*/\.]/.test(lastValue)){
        return;
      } else {
        try {
           const result = eval( document.querySelector('.new-account').value);
           document.querySelector('.new-account').value = result;
           document.querySelector('.old-account').value = result;

           if (result.toString().includes('.')){
            lastNumberContainsDecimal = true
           }
        } catch (error) {
           document.querySelector('.new-account').value = 'Error';
        }
      }
    }
    

  </script>

  <!-- Bootstrap -->
  <script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
  crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"
  ></script>
  
</body>
</html>